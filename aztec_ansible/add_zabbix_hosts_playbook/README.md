<!-- @format -->

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Aztec —Ö–æ—Å—Ç–æ–≤ –≤ Zabbix

–≠—Ç–æ—Ç Ansible –ø–ª–µ–π–±—É–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Aztec —Ö–æ—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Zabbix.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ansible (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –º–∞—à–∏–Ω–µ)
- Python3 —Å –º–æ–¥—É–ª–µ–º `json`
- curl
- –î–æ—Å—Ç—É–ø –∫ Zabbix —Å–µ—Ä–≤–µ—Ä—É —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–æ–≤
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω "Template Aztec Node Monitoring" –≤ Zabbix

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
aztec_ansible/
‚îú‚îÄ‚îÄ add_zabbix_hosts_playbook/
‚îÇ   ‚îú‚îÄ‚îÄ add_hosts_to_zabbix.yml       # Ansible –ø–ª–µ–π–±—É–∫
‚îÇ   ‚îú‚îÄ‚îÄ add_aztec_hosts_to_zabbix.sh  # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Zabbix API
‚îÇ   ‚îú‚îÄ‚îÄ run_06_add_host_to_zabbix.sh  # –û–±–µ—Ä—Ç–∫–∞-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ Ansible
‚îÇ   ‚îî‚îÄ‚îÄ README.md                     # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îî‚îÄ‚îÄ inventory/
‚îÇ       ‚îî‚îÄ‚îÄ hosts                     # –§–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Å —Ö–æ—Å—Ç–∞–º–∏
‚îî‚îÄ‚îÄ ...

# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ aztec_zabbix_template.xml         # –®–∞–±–ª–æ–Ω Zabbix –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ –≤ Zabbix

–°–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω –≤ –≤–∞—à Zabbix —Å–µ—Ä–≤–µ—Ä:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ Zabbix –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Configuration ‚Üí Templates
# –ù–∞–∂–º–∏—Ç–µ Import
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª aztec_zabbix_template.xml
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ API —Ç–æ–∫–µ–Ω–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ API —Ç–æ–∫–µ–Ω –≤ Zabbix:

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Zabbix
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Administration** ‚Üí **API tokens**
3. –ù–∞–∂–º–∏—Ç–µ **Create API token**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **Name**: `Aztec Monitoring`
   - **User**: –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–æ–≤
   - **Expires at**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –ù–∞–∂–º–∏—Ç–µ **Add**
6. **–í–∞–∂–Ω–æ**: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Å—Ä–∞–∑—É - –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω!

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `aztec_ansible/common/inventory/hosts` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞—à–∏ Aztec —Ö–æ—Å—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```ini
[aztec_nodes]
aztec-node-1 ansible_host=10.0.1.100
aztec-node-2 ansible_host=10.0.1.101
aztec-node-3 ansible_host=10.0.1.102
```

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –æ–±–µ—Ä—Ç–∫—É-—Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø–ª–µ–π–±—É–∫–æ–º
cd aztec_ansible/add_zabbix_hosts_playbook/

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±: —Å API —Ç–æ–∫–µ–Ω–æ–º
ZABBIX_SERVER=http://your-zabbix-server/zabbix \
ZABBIX_API_TOKEN=your-api-token-here \
./run_06_add_host_to_zabbix.sh

# Legacy —Å–ø–æ—Å–æ–±: —Å –ª–æ–≥–∏–Ω–æ–º/–ø–∞—Ä–æ–ª–µ–º
ZABBIX_SERVER=http://your-zabbix-server/zabbix \
ZABBIX_USER=Admin \
ZABBIX_PASSWORD=your-password \
./run_06_add_host_to_zabbix.sh

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º —Ñ–∞–π–ª–æ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (API —Ç–æ–∫–µ–Ω)
ZABBIX_SERVER=http://your-zabbix-server/zabbix \
ZABBIX_API_TOKEN=your-api-token-here \
./run_06_add_host_to_zabbix.sh /path/to/custom/inventory

# Verbose —Ä–µ–∂–∏–º (API —Ç–æ–∫–µ–Ω)
ZABBIX_SERVER=http://your-zabbix-server/zabbix \
ZABBIX_API_TOKEN=your-api-token-here \
./run_06_add_host_to_zabbix.sh --verbose

# Dry run (–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)
ZABBIX_SERVER=http://your-zabbix-server/zabbix \
ZABBIX_API_TOKEN=your-api-token-here \
./run_06_add_host_to_zabbix.sh --check
```

### 5. –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ Ansible –ø–ª–µ–π–±—É–∫–∞

```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø–ª–µ–π–±—É–∫–æ–º
cd aztec_ansible/add_zabbix_hosts_playbook/

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±: —Å API —Ç–æ–∫–µ–Ω–æ–º
export ZABBIX_SERVER=http://your-zabbix-server/zabbix
export ZABBIX_API_TOKEN=your-api-token-here

# –ó–∞–ø—É—Å–∫ –ø–ª–µ–π–±—É–∫–∞
ansible-playbook add_hosts_to_zabbix.yml

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, legacy —Å–ø–æ—Å–æ–±:
# export ZABBIX_USER=Admin
# export ZABBIX_PASSWORD=your-password
# ansible-playbook add_hosts_to_zabbix.yml
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –ü—Ä–∏–º–µ—Ä                             |
| ------------------ | ---------------------------------------- | ------------ | ---------------------------------- |
| `ZABBIX_SERVER`    | URL Zabbix —Å–µ—Ä–≤–µ—Ä–∞ (—Å –ø–æ—Ä—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ) | ‚úÖ –î–∞        | `http://zabbix.example.com/zabbix` |
| `ZABBIX_API_TOKEN` | API —Ç–æ–∫–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)                | ‚≠ê –û–ø—Ü–∏—è 1   | `abc123def456...`                  |
| `ZABBIX_USER`      | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (legacy)                | üîÑ –û–ø—Ü–∏—è 2   | `Admin`                            |
| `ZABBIX_PASSWORD`  | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (legacy)             | üîÑ –û–ø—Ü–∏—è 2   | `secretpassword`                   |

#### –ü—Ä–∏–º–µ—Ä—ã URL –¥–ª—è ZABBIX_SERVER

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã (80/443)
ZABBIX_SERVER=http://zabbix.example.com/zabbix
ZABBIX_SERVER=https://zabbix.example.com/zabbix

# –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ—Ä—Ç—ã
ZABBIX_SERVER=http://zabbix.example.com:8080/zabbix
ZABBIX_SERVER=https://zabbix.example.com:8443/zabbix
ZABBIX_SERVER=http://192.168.1.100:80/zabbix
ZABBIX_SERVER=https://monitoring.company.com:8443/zabbix

# –ë–µ–∑ –ø—É—Ç–∏ (–µ—Å–ª–∏ Zabbix –≤ –∫–æ—Ä–Ω–µ)
ZABBIX_SERVER=http://zabbix-server:8080
```

**–ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

- **–û–ø—Ü–∏—è 1 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ZABBIX_API_TOKEN` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–û–ø—Ü–∏—è 2 (Legacy):** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ZABBIX_USER` + `ZABBIX_PASSWORD` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–µ–π–±—É–∫–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –û–ø–∏—Å–∞–Ω–∏–µ                         | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                     |
| --------------------- | -------------------------------- | -------------------------------- |
| `inventory_file_path` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è           | `../common/inventory/hosts`      |
| `script_file_path`    | –ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–æ–≤ | `./add_aztec_hosts_to_zabbix.sh` |

### –û–ø—Ü–∏–∏ –æ–±–µ—Ä—Ç–∫–∏-—Å–∫—Ä–∏–ø—Ç–∞

| –û–ø—Ü–∏—è               | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
| ------------------- | ------------------------------------------- |
| `-h, --help`        | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É                            |
| `-v, --verbose`     | –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥                    |
| `-s, --script-path` | –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É                      |
| `--check`           | –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (dry run)          |
| `--tags`            | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏ |
| `--skip-tags`       | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á–∏ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏       |

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–ª–µ–π–±—É–∫

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** - —É–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏ —Å–∫—Ä–∏–ø—Ç–∞
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞** - –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
4. **–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–æ–≤** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
5. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

**–û—à–∏–±–∫–∞: "ansible-playbook is not installed"**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ansible
pip install ansible
# –∏–ª–∏
brew install ansible  # –Ω–∞ macOS
```

**–û—à–∏–±–∫–∞: "Template 'Template Aztec Node Monitoring' not found"**

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —à–∞–±–ª–æ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ Zabbix
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞

**–û—à–∏–±–∫–∞: "Authentication failed"**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL Zabbix —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–æ–≤

**–û—à–∏–±–∫–∞: "Inventory file not found"**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è

### –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
ZABBIX_SERVER=... ./run_06_add_host_to_zabbix.sh -vvv

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
ZABBIX_SERVER=... ./run_06_add_host_to_zabbix.sh --check --verbose
```

### –õ–æ–≥–∏

–ü–ª–µ–π–±—É–∫ –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ:

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ—Ü–µ—Å—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞
- –û—à–∏–±–∫–∞—Ö –∏ –∏—Ö –ø—Ä–∏—á–∏–Ω–∞—Ö
- –†–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ:

1. `aztec_ansible/add_zabbix_hosts_playbook/add_hosts_to_zabbix.yml` - –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ —Å–µ–∫—Ü–∏—é `vars`
2. `run_06_add_host_to_zabbix.sh` - –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. `add_aztec_hosts_to_zabbix.sh` - –æ–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∏ –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–æ–≤, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `add_aztec_hosts_to_zabbix.sh`:

```bash
TEMPLATE_NAME="Your Custom Template Name"
HOSTGROUP_NAME="Your Custom Group Name"
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ä–µ–¥–∞

```bash
cd aztec_ansible/add_zabbix_hosts_playbook/
ZABBIX_SERVER=https://monitoring.company.com/zabbix \
ZABBIX_API_TOKEN=$(cat /secure/zabbix-api-token) \
./run_06_add_host_to_zabbix.sh production-inventory.ini --verbose
```

### –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞

```bash
cd aztec_ansible/add_zabbix_hosts_playbook/
ZABBIX_SERVER=http://test-zabbix:8080/zabbix \
ZABBIX_API_TOKEN=test-api-token-here \
./run_06_add_host_to_zabbix.sh test-hosts.ini --check
```

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```bash
#!/bin/bash
# –í CI/CD –ø–∞–π–ø–ª–∞–π–Ω–µ
cd aztec_ansible/add_zabbix_hosts_playbook/
export ZABBIX_SERVER="$ZABBIX_URL"
export ZABBIX_API_TOKEN="$ZABBIX_TOKEN"  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –¥–ª—è legacy —Å–∏—Å—Ç–µ–º:
# export ZABBIX_USER="$ZABBIX_USERNAME"
# export ZABBIX_PASSWORD="$ZABBIX_SECRET"

./run_06_add_host_to_zabbix.sh "$INVENTORY_FILE" --verbose || exit 1
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Zabbix —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ —Å `--verbose`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Ansible
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
