<!-- @format -->

# üîÑ Aztec Sync Check - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–æ–¥

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

Ansible –ø–ª–µ–π–±—É–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö Aztec –Ω–æ–¥ –≤ —Å–µ—Ç–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
./sync_check.sh
```

### –ò–∑ –ø–∞–ø–∫–∏ get_proof_playbook:

```bash
cd aztec_ansible/get_proof_playbook
./run_sync_check.sh
```

## üîß –û–ø—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞

### –û–±—ã—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
./sync_check.sh
```

### –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º:

```bash
VERBOSE=1 ./sync_check.sh
```

### –° —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º:

```bash
TIMEOUT=120 ./sync_check.sh
```

### –ü–æ–º–æ—â—å:

```bash
./sync_check.sh --help
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Inventory —Ñ–∞–π–ª**: `aztec_ansible/common/inventory/hosts`
2. **SSH –∫–ª—é—á**: `aztec_ansible/common/ssh/id_rsa`
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã** —á–µ—Ä–µ–∑ install playbook

### –ï—Å–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

```bash
# –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Å–µ—Ä–≤–µ—Ä—ã
cd aztec_ansible/install_playbook
./run_01_prepare.sh path/to/your/servers.csv

# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
cd ..
./sync_check.sh
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### –°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

- **SYNCED** ‚úÖ - –ù–æ–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- **SYNCING** ‚è≥ - –ù–æ–¥–∞ –µ—â–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
- **NO_NODE** ‚ùå - –ù–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
- **RPC_ERROR** üö´ - –û—à–∏–±–∫–∞ RPC –∑–∞–ø—Ä–æ—Å–æ–≤
- **TIMEOUT** ‚è∞ - –ü—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- **ERROR** üí• - –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏

### –§–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: `sync_results.csv`

```csv
ip,hostname,local_block,remote_block,sync_status,port,timestamp,raw_output
95.216.84.227,node1,2601,2601,SYNCED,8080,2024-01-15T10:30:00Z,"‚úÖ Detected app running on port 8080..."
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
========================================
        AZTEC SYNC CHECK SUMMARY
========================================
Total servers checked: 10
‚úÖ Fully synced:      8
‚è≥ Still syncing:     1
‚ùå No node found:     1
üö´ RPC errors:        0
‚è∞ Timeouts:          0
üí• Other errors:      0
Success rate:         80%
========================================

‚úÖ Successfully synced nodes:
  95.216.84.227 (node1) - Block: 2601
  95.216.84.228 (node2) - Block: 2601

‚è≥ Nodes still syncing:
  95.216.84.229 (node3) - 2598/2601

‚ùå Nodes not running:
  95.216.84.230 (node4)
```

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ä—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. **8080** (–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ä—Ç Aztec)
2. **8081** (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç)
3. **8082** (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø–æ—Ä—Ç)

### RPC –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –Ω–æ–¥–∞**: `http://localhost:PORT/` - –º–µ—Ç–æ–¥ `node_getL2Tips`
2. **–£–¥–∞–ª–µ–Ω–Ω–∞—è –Ω–æ–¥–∞**: `https://aztec-rpc.cerberusnode.com` - —Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥
3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

- **Exit code 0**: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- **Exit code 1**: –ù–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- **Exit code 2**: –û—à–∏–±–∫–∞ RPC
- **Exit code 3**: –ï—â–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
- **Exit code 124**: –¢–∞–π–º–∞—É—Ç

## ‚ö° –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| ---------- | ------------ | ------------------------------------------ |
| `TIMEOUT`  | 60           | –¢–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (—Å–µ–∫—É–Ω–¥—ã) |
| `VERBOSE`  | 0            | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ (1 = –≤–∫–ª—é—á–µ–Ω)              |

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ù–µ—Ç inventory —Ñ–∞–π–ª–∞:

```bash
‚ùå Inventory —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ../common/inventory/hosts

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è inventory —Ñ–∞–π–ª–∞:
  cd ../install_playbook
  ./run_01_prepare.sh path/to/your/servers.csv
```

### –ù–µ—Ç SSH –∫–ª—é—á–∞:

```bash
‚ùå SSH –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω: ../common/ssh/id_rsa
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ install playbook
```

### –í verbose —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:

```
Sync check results for 95.216.84.227:
Return code: 0
Status: SYNCED
Local block: 2601
Remote block: 2601
Port: 8080
Output: ‚úÖ Detected app running on port 8080...
Error: N/A
```

## üîÑ –û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–±–ª–µ–º—ã:

- ‚ùå –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª `while true`
- ‚ùå –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ –ø–æ—Ä—Ç–∞
- ‚ùå –†—É—á–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ `Ctrl+C`

### –ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ:

- ‚úÖ –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ —Ü–∏–∫–ª–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ exit codes
- ‚úÖ –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
tail -f aztec_ansible/logs/sync_check_*.log

# –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
watch -n 5 "tail -10 aztec_ansible/get_proof_playbook/sync_results.csv"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
*/30 * * * * cd /path/to/aztec && ./sync_check.sh >> /var/log/aztec_sync_check.log 2>&1
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CI/CD

```bash
#!/bin/bash
# –í –ø–∞–π–ø–ª–∞–π–Ω–µ CI/CD

cd /path/to/aztec
./sync_check.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
if grep -q ",SYNCED," sync_results.csv; then
    echo "‚úÖ –í—Å–µ –Ω–æ–¥—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"
    exit 0
else
    echo "‚ùå –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π"
    exit 1
fi
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å proof –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
./sync_check.sh && ./get_proof.sh

# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
VERBOSE=1 ./sync_check.sh
VERBOSE=1 ./get_proof.sh
```
